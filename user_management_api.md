# 用户管理API设计文档

## 角色权限概述

1. **访客**
   - 无需注册即可访问
   - 可以查看所有演员的部分信息（不包括联系信息）
   - 前端提供访客登录按钮

2. **演员**
   - 需要注册，注册时需要邀请码（由管理员/经纪人提供）
   - 可以查看所有演员的部分信息
   - 可以查看、新建、修改、删除自己的所有信息
   - 如果没有邀请码，注册后需要经纪人操作划归自己旗下

3. **经纪人**
   - 由管理员生成，不能自己注册
   - 可以查看所有演员的部分信息
   - 可以查看、新建、修改、删除自己的所有信息
   - 可以查看、新建、修改、删除自己旗下的演员信息（包括所有信息）
   - 可以生成邀请码，邀请码直接定义演员归属于该经纪人

4. **管理员**
   - 拥有所有权限
   - 可以管理所有用户和演员信息

## API 功能设计

### 1. 用户注册API
- **路径**: `POST /api/v1/users/register`
- **功能**: 用户注册
- **请求参数**:
  - `username`: 用户名
  - `password`: 密码
  - `invitation_code`: 邀请码（可选）
- **逻辑**:
  - 验证用户名是否已存在
  - 验证邀请码（如果提供）
  - 对密码进行哈希处理
  - 创建用户记录，默认角色为演员
  - 如果没有邀请码，标记为待分配状态

### 2. 用户登录API
- **路径**: `POST /api/v1/users/login`
- **功能**: 用户登录
- **请求参数**:
  - `username`: 用户名
  - `password`: 密码
- **逻辑**:
  - 验证用户名和密码
  - 根据用户角色生成不同权限的JWT令牌
  - 返回令牌和用户角色信息

### 3. 访客登录API
- **路径**: `POST /api/v1/users/guest-login`
- **功能**: 访客登录
- **逻辑**:
  - 生成访客角色的JWT令牌
  - 返回令牌

### 4. 邀请码生成API
- **路径**: `POST /api/v1/users/generate-invitation`
- **功能**: 生成邀请码
- **权限**: 仅经纪人和管理员可操作
- **逻辑**:
  - 生成6位数邀请码
  - 邀请码与经纪人ID关联
  - 返回邀请码

### 5. 用户信息管理API
- **路径**: `GET /api/v1/users/{id}`
- **功能**: 获取用户信息
- **权限**: 根据用户角色限制访问

- **路径**: `PUT /api/v1/users/{id}`
- **功能**: 更新用户信息
- **权限**: 用户只能更新自己的信息

- **路径**: `DELETE /api/v1/users/{id}`
- **功能**: 删除用户
- **权限**: 仅管理员可操作

## API 制作规划

### 用户管理
| 方法 | 路径 | 描述 | 状态 | 实现模块 |
|------|------|------|------|----------|
| POST | `/api/v1/users/register` | 用户注册 | ❌ | 未实现 |
| POST | `/api/v1/users/login` | 用户登录 | ❌ | 未实现 |
| POST | `/api/v1/users/guest-login` | 访客登录 | ❌ | 未实现 |
| POST | `/api/v1/users/generate-invitation` | 生成邀请码 | ❌ | 未实现 |
| GET | `/api/v1/users/{id}` | 获取用户信息 | ❌ | 未实现 |
| PUT | `/api/v1/users/{id}` | 更新用户信息 | ❌ | 未实现 |
| DELETE | `/api/v1/users/{id}` | 删除用户 | ❌ | 未实现 |

## 设计思路

- **注册**: 用户通过提供用户名和密码进行注册，系统默认将其角色设置为演员。邀请码用于直接将演员归属于经纪人。
- **登录**: 用户通过用户名和密码登录，系统验证后根据角色生成相应的JWT令牌。
- **权限控制**: 在每个API中，根据用户的角色进行权限验证，确保用户只能访问和操作其权限范围内的资源。
- **角色升级**: 通过管理员界面或API，管理员可以将用户角色从访客升级为演员、经纪人或管理员。 